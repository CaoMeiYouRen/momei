# AI 协作规范 (AI Collaboration Standards)

本规范为墨梅 (Momei) 项目中 AI 智能体（Agents）的行为准则，旨在确保 AI 在自动化过程中逻辑严密、安全合规且不破坏现有工程质量。

## 1. 身份认同 (Identity)

每个 AI 智能体在启动任务前，必须明确自己的角色定位（见 `AGENTS.md`）。
- **禁止跨权**：`@qa-assistant` 严禁修改代码；`@test-engineer` 应专注于测试编写。
- **环境感知**：执行命令前，必须通过 `os` 信息判断当前是 Windows 还是 POSIX 环境，并使用正确的命令语法。

## 2. 核心工作流：PDTFC+ 循环

所有写操作任务必须遵循以下循环。**跳过步骤即为违规。**

### P (Plan) - 需求分析
- 必须读取 `docs/plan/roadmap.md` 和 `docs/plan/todo.md`。
- 如果需求存在歧义，必须发起“采访”模式向开发者提问。
- 输出修改方案，列出受影响的文件清单。

### D (Do) - 业务执行
- 遵循 TypeScript 优先原则（无 `any`）。
- 遵循 SCSS BEM 命名。
- UI 文本必须使用 `$t()` 国际化包裹。

### V (Validate) - UI 验证
- 对于 UI 相关改动，必须通过浏览器访问实际页面。
- 访问前先检查开发服务器端口 (3000)，若未启动则手动启动。
- 通过截图、快照或计算样式验证渲染效果，确保兼容暗色模式。

### T (Test) - 质量检查
- 执行 `pnpm lint` 和 `pnpm typecheck`。
- 执行 `pnpm test` (Vitest)。
- 如果旧测试失败，必须优先分析导致失败的原因（是功能破坏还是测试过时）。

### F (Fix) - 缺陷修复
- 自动修复 T 阶段发现的 Lint 错误或逻辑 Bug。
- 重复 T 阶段直至 100% 通过。

### C (Commit 1) - 功能提交
- 使用 `conventional-committer` 进行提交。
- 提交描述使用中文，遵循 Conventional Commits 规范。

### E (Enhance) - 测试增强
- 为新增的功能逻辑补齐测试用例。
- 确保护盖率达到项目要求的阈值。

### C+ (Commit 2) - 测试提交
- 提交增强后的测试代码。

## 3. 安全与红线 (Security Redlines)

1.  **敏感文件保护**：严禁修改或删除 `.env`, `AGENTS.md` 等核心配置文件，除非有明确指示。
2.  **路径校验**：执行涉及删除的命令 (`rm`, `rd`) 前，必须验证路径是否存在且非空。
3.  **密钥脱敏**：绝不在代码或日志中硬编码 API Key、Token 或任何敏感凭据。
4.  **死循环规避**：如果在 F 阶段重复 3 次仍无法修复 Bug，必须停止执行并请求人类介入，禁止无限循环。

## 4. 沟通原则

- **简明扼要**：回复应直接、专业，避免冗余的客套话。
- **证据链条**：在提出方案或得出结论时，应引用具体的代码文件路径或文档内容。
- **透明度**：在执行大规模修改前，应向用户展示预期的代码变更范围。
