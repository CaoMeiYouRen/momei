# E2E 测试增强设计文档 (E2E Testing Enhancement)

## 1. 概述 (Overview)

端对端 (E2E) 测试是确保墨梅博客平台核心业务流程稳定性的关键。目前的 E2E 测试仅覆盖了首页的基础渲染、语言切换和主题切换等表面逻辑。为了实现项目高质量交付的目标，本文档旨在分析当前的 E2E 测试现状，识别关键测试盲区，并设计一套完整的增强方案。

## 2. 现状分析 (Current Status)

### 2.1 已有覆盖量
目前仅存在 `tests/e2e/home.e2e.test.ts`，涵盖：
-   首页标题加载
-   Header 与 Logo 可见性
-   i18n 语言切换功能
-   暗色模式切换
-   基本搜索导航跳转

### 2.2 测试盲区 (Critical Gaps)
-   **身份验证流 (Auth Flow)**: 登录、注册、找回密码及验证码交互完全缺失。
-   **创作与管理流 (Content Management)**: 管理后台的登录、文章发表（包含 AI 辅助）、分类/标签管理、设置修改未覆盖。
-   **阅读深度体验 (Reading Experience)**: 文章详情页加载、目录导航、评论系统交互、赞赏码显示等。
-   **系统部署流 (Infrastructure)**: 系统的安装向导 (Installation) 逻辑测试。
-   **复杂交互 (Advanced Interactions)**: 全球搜索的高级筛选、多级分类导航、响应式适配。

## 3. 重点测试页面与设计点 (Test Points Design)

### 3.1 身份验证模块 (Authentication)
**目标**: 确保用户能够安全、顺畅地进入系统。
-   **登录页面 (`/login`)**:
    -   表单校验（邮箱格式、密码长度）。
    -   登录成功后的跳转逻辑。
    -   错误提示（账号密码不匹配）。
-   **注册页面 (`/register`)**:
    -   验证码 (Captcha) 的刷新与验证流。
    -   账号唯一性检查。
-   **密码找回 (`/forgot-password`)**:
    -   邮件发送逻辑触发。
    -   重置密码链接的有效性验证。

### 3.2 创作中心 (Admin Posts)
**目标**: 验证博客的核心生产力工具。
-   **文章编辑器 (`/admin/posts/new`, `/admin/posts/[id]`)**:
    -   标题与正文输入。
    -   AI 一键润色/生成摘要功能的 UI 触发与结果回填。
    -   发布设置（分类选择、标签添加、自定义路径）。
    -   自动保存逻辑验证。
-   **媒体管理**:
    -   图片上传、占位符生成。

### 3.3 文章详情与交互 (Post & Interactions)
**目标**: 确保读者的阅读和反馈体验。
-   **文章详情页 (`/posts/[id]`)**:
    -   目录 (TOC) 的点击跳转。
    -   渲染器准确性（代码高亮、数学公式 KaTeX、Mermaid 图表）。
    -   版权信息与赞赏组件。
-   **评论系统**:
    -   评论提交流（匿名或登录用户）。
    -   回复、点赞、举报交互。

### 3.4 搜索与分类 (Search & Taxonomy)
**目标**: 确保内容的高效发现。
-   **实时搜索**:
    -   输入联想提示。
    -   搜索结果的分页与排序。
-   **分类与标签页**:
    -   点击标签后，文章列表的过滤效果。
    -   面包屑导航的准确性。

### 3.5 系统初始化 (Installation)
**目标**: 确保新用户的“第一分钟”体验。
-   **安装向导**:
    -   数据库配置验证。
    -   管理员账户初始化设置。
    -   系统核心参数配置。

## 4. 增强方案建议 (Technical Advice)

### 4.1 核心公共能力封装
-   **`auth.helper.ts`**: 封装 `loginAsAdmin()`、`logout()` 等通用操作，避免每个测试文件重复编写登录逻辑。
-   **`mock-api.ts`**: 为 E2E 环境提供稳定的 API Mock 策略，特别是涉及 AI 生成和邮件发送等不可控服务时。

### 4.2 环境隔离
-   **测试数据库**: E2E 测试应始终连接到独立的测试数据库（如 `sqlite::memory:` 或专门的 `test_db`）。
-   **`TEST_MODE` 标记**: 在测试环境下运行 Nuxt 时，自动禁用生产混淆与高强度速率限制。

### 4.3 浏览器与设配覆盖
-   **桌面端**: Chrome, Firefox, Safari (Webkit)。
-   **移动端**: 增加对 iPhone 13/Android 设配的视图模拟，重点验证 Header 菜单和 Table of Contents 在移动端的收展效果。

## 5. 执行计划 (Roadmap)

1.  **Phase 1**: 实现 Auth 基础流测试（登录/注销）。
2.  **Phase 2**: 实现文章详情页与阅读体验测试（TOC/评论）。
3.  **Phase 3**: 覆盖管理后台核心逻辑（文章发布/AI 辅助）。
4.  **Phase 4**: 补齐安装向导与边缘情况（404/权限控制）。
