# 搜索模块设计文档 (Search Module Design)

## 1. 概述 (Overview)

搜索功能是博客系统的核心导航手段之一。其目标是让用户能够在海量文章中精准找到关注的内容。高级搜索需要支持全文检索、多维度过滤（分类、标签、语言）以及相关性排序。

## 2. 核心挑战与策略 (Core Challenges & Strategies)

### 2.1 国际化 (i18n) 检索

-   **挑战**: 在墨梅的设计中，不同语言版本是独立的 Post 实体。
-   **策略**:
    -   **自动过滤**: 默认搜索结果仅显示与当前站点语言一致的内容。
    -   **跨语言搜索**: 提供开关允许用户搜索“所有语言”的结果。
    -   **结果去重**: 如果搜索结果中有同一个翻译簇（相同 `translationId`）的多篇文章，根据权重（当前语言优先）仅展示最佳匹配项。

### 2.2 过滤维度

-   **分类 (Category)**: 单选过滤。
-   **标签 (Tag)**: 多选过滤。
-   **作者 (Author)**: 虽然目前暂不需要，但架构应预留支持。

## 3. 技术选型 (Technical Selection)

-   **初级方案 (MVP)**: 基于数据库的 `LIKE` 或 `ILike` 查询。
    -   优点：实现简单，无需额外依赖。
    -   缺点：性能随数据量增长而下降，相关性排序评分较弱。
-   **进阶方案 (P1)**: 集成 **Algolia** / **Meilisearch** / **Fuse.js**。
    -   **Algolia**: 托管式，搜索体验最佳，支持地理位置、分词等，首选。
    -   **Fuse.js**: 适用于轻量级全量搜索，可将所有文章摘要和元信息缓存到前端。

## 4. 接口设计 (API Design)

### 4.1 综合搜索接口

`GET /api/search`

-   **请求参数**:

    -   `q`: 搜索关键词 (必需)。
    -   `lang`: 指定语言编码 (可选，如 `zh-CN`, `en-US`, `all`)。
    -   `category`: 分类 ID 或 Slug (可选)。
    -   `tags`: 标签 ID 或 Slug 列表 (可选，多个用逗号分隔)。
    -   `page`: 分页码 (默认 1)。
    -   `limit`: 每页数量 (默认 10)。

-   **响应格式**:

```json
{
    "code": 200,
    "data": {
        "list": [
            {
                "id": "...",
                "title": "...",
                "slug": "...",
                "summary": "...",
                "language": "zh-CN",
                "category": { "name": "..." },
                "tags": [{ "name": "..." }],
                "highlights": { "title": "...", "content": "..." }
            }
        ],
        "total": 50,
        "page": 1,
        "limit": 10
    }
}
```

## 5. UI/UX 设计原则

1. **全局快捷键**: 支持 `Ctrl+K` (或 `Cmd+K`) 唤起搜索弹窗。
2. **实时反馈**: 搜索框输入时显示建议列表。
3. **标签过滤 UI**: 在搜索结果页侧边栏提供分类点击过滤和标签云。
4. **高亮显示**: 在搜索结果的标题和摘要中高亮显示命中的关键词。

## 6. 待办事项 (Todos)

-   [ ] 实现 `GET /api/search` 基础 API。
-   [ ] 后端支持多级 SQL 关联查询以支持按标签和分类过滤。
-   [ ] 前端实现全局搜索组件 (Modal)。
-   [ ] 搜索结果页开发，包含侧边栏过滤功能。
