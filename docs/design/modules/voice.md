# AI 语音创作增强设计文档 (AI Voice Creative Enhancement)

本文档定义了墨梅博客中 AI 语音创作增强功能的实现方案。该功能旨在通过浏览器原生能力实现低成本、轻量化的语音转文字 (V2T) 创作体验，并结合后端 AI 进行内容润色。

## 1. 核心目标

- **轻量化**: 优先利用浏览器原生 Web Speech API，不引入重量级客户端 SDK。
- **低成本**: 第一阶段由浏览器完成识别，不产生额外的云服务费用。
- **高效率**: 适配移动端/碎片化场景，通过语音快速捕捉灵感。
- **质量可控**: 识别出的文本可通过 AI 助手进行二次润色，解决“识别准但不成文”的问题。

## 2. 技术方案

### 2.1 语音识别驱动 (Core V2T)

- **核心 API**: `window.SpeechRecognition` (及其供应商前缀版 `window.webkitSpeechRecognition`)。
- **降级处理**: 
    - 若浏览器不支持（如 Firefox、部分国产移动浏览器），UI 端隐藏或置灰相关按钮，并提示用户切换至 Chrome/Edge。
    - 未来若用户有高精度需求，可扩展支持 OpenAI Whisper 或其他高性能 API。

### 2.2 状态管理 (Composable Design)

新建 `composables/use-post-editor-voice.ts`，导出以下状态与方法：

- **State**:
    - `isListening`: 是否正在监听录音。
    - `isSupported`: 当前环境是否支持 Web Speech API。
    - `interimTranscript`: 临时识别结果（随着实时识别不断更新）。
    - `finalTranscript`: 已确认的识别结果。
    - `error`: 识别过程中的错误信息（如“无麦克风权限”、“网络中断”）。

- **Methods**:
    - `startListening(lang)`: 开启监听，指定识别语言。
    - `stopListening()`: 停止监听并返回最终文本。
    - `reset()`: 重置状态。

### 2.3 自动语言适配 (Language Logic)

- 系统将根据当前文章的 `post.language` 自动配置识别语言：
    - `zh-CN` -> `zh-CN`
    - `en-US` -> `en-US`
    - 其他语言按需映射。

## 3. UI/UX 交互设计

### 3.1 挂载位置

- **PC 端**: 在 `PostEditorHeader.vue` 的工具栏部分（标题输入框右侧）增加一个麦克风按钮。
- **移动端**: 增加底部的快捷浮动动作条。

### 3.2 流程图

```mermaid
graph TD
    A[点击麦克风按钮] --> B{浏览器支持?}
    B -- 否 --> C[提示暂不支持/降级]
    B -- 是 --> D[开启 SpeechRecognition]
    D --> E[用户说话]
    E --> F[实时更新浮层文字]
    F --> G[用户再次点击/超时停止]
    G --> H{动作选择}
    H -- 直接插入 --> I[Appending to Content]
    H -- AI 润色 --> J[调用 /api/ai/refine-voice]
    J --> K[插入优化后的文字]
```

### 3.3 录制过程流

1. **唤起**: 点击麦克风按钮。
2. **状态反馈**: 
    - 按钮颜色变为红色并带有脉冲动画。
    - 页面底部弹出半透明浮层，显示 `interimTranscript` (实时更新的文字流)。
3. **完成**: 再次点击按钮或一段时间不说话（超时）。
4. **插入逻辑**:
    - 识别完成后，提供两个按钮：
        - **[直接插入]**: 将识别结果原封不动插入光标处。
        - **[AI 润色后插入]**: (推荐) 将文字发回后端，由 LLM 转换为符合 Markdown 规范、语气正式的博文片段。

## 4. 后续扩展计划 (Phase 2)

- **AI 对话式润色**: 允许用户通过语音发出指令，如“把这段改得幽默一点”或“给这段加个标题”。
- **Whisper 集成**: 为追求极致质量的用户提供 OpenAI Whisper 调用开关（需配置 API Key）。
- **离线音频上传**: 支持上传现有的音频文件，通过 Whisper 进行转写。

## 5. 安全与隐私

- **权限申请**: 必须在用户主动触发（点击按钮）后请求麦克风权限。
- **敏感数据**: 浏览器原生的语音识别通常在本地或浏览器厂商云端完成。设计文档中明确告知用户数据流向。
